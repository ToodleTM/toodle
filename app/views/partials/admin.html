<div ng-include="'partials/navbar'"></div>

<div id="content">
    <div id="error" class="alert alert-danger" role="alert" hidden>
        <button type="button" class="close alert-fix-close" ng-click="hideAlerts()"><span
                aria-hidden="true">&times;</span><span
                class="sr-only">Close</span></button>
        {{ 'admin.error.'+error | translate}}
    </div>
    <h1><span translate="admin.header.tournament"></span> {{tournamentInfo.tournamentName}} <span translate="admin.header.adminPage"></span></h1>
    <button ng-hide="tournamentInfo.running" id="lockTournament" class="btn {{ tournamentInfo.locked ? 'btn-success' : 'btn-danger'}}"
            title="{{ tournamentInfo.locked ? 'admin.actions.openTooltip' : 'admin.actions.lockTooltip' | translate }}"
            ng-click="toggleRegistrationLock()" id="lockTournamentButton" translate="{{ tournamentInfo.locked ? 'admin.actions.open' : 'admin.actions.lock'}}">
    </button>

    <button id="runTournament" data-toggle="modal" data-target="#runModal"
            class="btn {{ tournamentInfo.running ? 'btn-success' : 'btn-danger'}}"
            title="{{ !tournamentInfo.running ? 'admin.actions.run.runningTooltip' : 'admin.actions.run.notRunningTooltip' | translate }}" translate="{{tournamentInfo.running ? 'admin.actions.run.running' : 'admin.actions.run.notRunning'}}">
    </button>

    <!-- Start / Stop Modal -->
    <div class="modal fade" id="runModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span
                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="myModalLabel" translate="admin.actions.run.modalTitle"></h4>
                </div>
                <div class="modal-body">
                    <span ng-show="tournamentInfo.running" translate="admin.actions.run.willStop"></span>
                    <span ng-show="!tournamentInfo.running" translate="admin.actions.run.willStart"></span>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" translate="admin.actions.run.cancel"></button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="toggleStart()"
                            id="doStart" translate="admin.actions.run.confirm"></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reporting Modal -->
    <div class="modal fade" id="reportModal" tabindex="-1" role="dialog" aria-labelledby="reportModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span
                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="reportModalLabel"><span translate="admin.actions.reporting.title"></span> - {{firstGameToReport.player1.name }} VS {{firstGameToReport.player2.name}}</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal">

                        <legend translate="admin.actions.reporting.describeReport"></legend>
                        <fieldset>
                            <div class="row">
                                <div class="form-group col-sm-4">
                                    <label class="control-label" for="score1"> {{firstGameToReport.player1.name}} <span translate="admin.actions.reporting.playerScore"></span></label>
                                    <input type="tel" id="score1" ng-model="score1" class="form-control"/>

                                </div>
                                <div class="form-group col-sm-4">
                                    <label class="control-label" for="score2"> {{firstGameToReport.player2.name}} <span translate="admin.actions.reporting.playerScore"></span></label>
                                    <input type="tel" id="score2" ng-model="score2" class="form-control"/>
                                </div>
                                <input type="hidden" ng-model="firstGameToReport.number">
                            </div>
                        </fieldset>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" id="cancelReport" translate="admin.actions.run.cancel">
                    </button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="reportMatch()"
                            id="doReport" translate="admin.actions.run.confirm">
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="unreportModal" tabindex="-1" role="dialog" aria-labelledby="unreportModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span
                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="unreportModalLabel"><span translate="admin.actions.reporting.unreportTitle"></span> - {{
                        gameToUnreport.player1.name }} VS {{gameToUnreport.player2.name}}</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal">
                        <div class="row">
                            <div class="form-group col-sm-12">
                                <p translate="admin.actions.reporting.warning"></p>
                            </div>
                        </div>
                        <input type="hidden" ng-model="gameToUnreport.number">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" id="cancelUnreport" translate="admin.actions.run.cancel">
                    </button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="unreportMatch()"
                            id="doUnreport" translate="admin.actions.run.confirm">
                    </button>
                </div>
            </div>
        </div>
    </div>


    <div id="tourneyRunOk" class="alert alert-success alert-dismissible app-alert" role="alert" hidden>
        <button type="button" class="close alert-fix-close" ng-click="hideAlerts()"><span
                aria-hidden="true">&times;</span><span
                class="sr-only">Close</span></button>
        <p translate="admin.update.success"></p>
    </div>
    <div id="tourneyRunKo" class="alert alert-danger alert-dismissible app-alert" role="alert" hidden>
        <button type="button" class="close alert-fix-close" ng-click="hideAlerts()"><span
                aria-hidden="true">&times;</span><span
                class="sr-only">Close</span></button>
        <span translate="admin.update.fail"></span> (<span translate="{{errorMessage}}"></span>)
    </div>

    <p translate="admin.intro"></p>
    <fieldset>
        <legend translate="admin.misc.links"></legend>
        <a ng-href="/play/{{tournamentInfo.signupID}}" id="playerSignupPageLink" translate="admin.misc.playLink"></a><br/>
        <a ng-show="tournamentInfo.running" ng-href="/bracket/{{tournamentInfo.signupID}}" id="tournamentBracketLink" translate="admin.misc.brackets"></a><br/>
        <a ng-show="tournamentInfo.running && !gamesToReport.length" href="#" ng-click="downloadTournamentWinners()" translate="admin.misc.winners"></a>
    </fieldset>

    <fieldset ng-show="tournamentInfo.running">
        <legend translate="admin.actions.reporting.title"></legend>
        <div class="form-group col-sm-6">
            <label class="control-label" for="reportGame" translate="admin.actions.reporting.reportMatch"></label>

            <select id="reportGame" name="reportGame" class="form-control" ng-model="firstGameToReport"
                    ng-options="item as item.player1.name+' VS '+item.player2.name for item in gamesToReport track by item.number">
            </select>
            <button ng-show="gamesToReport.length" id="reportGameButton" data-toggle="modal" data-target="#reportModal"
                    class="btn btn-primary"
                    title="{{'admin.actions.reporting.reportButton'|translate}}" translate="admin.actions.reporting.reportButton">
            </button>
        </div>

        <div class="form-group col-sm-6">
            <label class="control-label" for="unreportGame" translate="admin.actions.reporting.unreportMatch"></label>

            <select id="unreportGame" name="unreportGame" class="form-control" ng-model="gameToUnreport"
                    ng-options="item as item.player1.name+' VS '+item.player2.name for item in gamesToUnreport track by item.number">
            </select>
            <button ng-show="gamesToUnreport.length" id="unreportGameButton" data-toggle="modal" data-target="#unreportModal"
                    class="btn btn-primary"
                    title="{{'admin.actions.reporting.unreportButton'|translate}}" translate="admin.actions.reporting.unreportButton">
            </button>
        </div>
        <div class="form-group col-sm-12">
            <div id="tourneyReportingOk" class="alert alert-success alert-dismissible app-alert" role="alert" hidden>
                <button type="button" class="close alert-fix-close" ng-click="hideAlerts()"><span
                        aria-hidden="true">&times;</span><span
                        class="sr-only">Close</span></button>
                <span translate="admin.actions.reporting.reportingOk"></span>
            </div>
            <div id="tourneyReportingKo" class="alert alert-danger alert-dismissible app-alert" role="alert" hidden>
                <button type="button" class="close alert-fix-close" ng-click="hideAlerts()"><span
                        aria-hidden="true">&times;</span><span
                        class="sr-only">Close</span></button>
                <span translate="admin.actions.reporting.reportingKo"></span> ({{
                'admin.actions.reporting.errors.'+errorMessage.message | translate}})
            </div>
        </div>
    </fieldset>
    <form class="form-horizontal" ng-submit="updateTourney()">
        <fieldset>

            <legend translate="admin.form.configure"></legend>
            <div class="row">

                <div class="form-group col-sm-6">
                    <label class="control-label" for="game" translate="admin.form.game"></label>

                    <select id="game" name="game" class="form-control" ng-model="tournamentInfo.game">
                        <option value="" translate="admin.form.pickGame"></option>
                        <option value="sc2">Starcraft II</option>
                        <option value="other" translate="admin.form.other"></option>
                    </select>
                </div>

                <div class="form-group col-sm-6">
                    <label class="control-label" for="engine" translate="admin.form.engine"></label>

                    <select id="engine" name="engine" class="form-control" ng-model="tournamentInfo.engine"
                            required="required">
                        <option value="none"> --- </option>
                        <option value="singleElim">Single elim. bracket</option>
                        <option value="simpleGSLGroups">Simple groupstages (SC2 GSL format)</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="form-group col-sm-12">
                    <label class="control-label" for="description" translate="admin.form.description"></label>
                    <textarea id="description" name="description" class="form-control"
                              ng-model="tournamentInfo.description"></textarea>
                </div>
            </div>
            <div class="row">
                <div class="form-group col-sm-6">
                    <label class="control-label" for="tournamentStart" translate="admin.form.startDate"></label>
                    <input type="text" id="tournamentStart" class="form-control" ng-model="tournamentStartDate"/>
                </div>

                <div class="form-group col-sm-6">
                    <label class="control-label" for="reportRights" translate="admin.form.userPrivileges.title"></label>

                    <div class="controls" id="reportRights" style="margin-left:20px;">
                        <label class="radio" for="reportRights-0">
                            <input type="radio" name="reportRights" id="reportRights-0" value="3"
                                   ng-model="tournamentInfo.userPrivileges" required="required">
                            <span translate="admin.form.userPrivileges.atWill"></span>
                        </label>
                        <label class="radio" for="reportRights-1">
                            <input type="radio" name="reportRights" id="reportRights-1" value="2"
                                   ng-model="tournamentInfo.userPrivileges" required="required">
                            <span translate="admin.form.userPrivileges.reportOnly"></span>
                        </label>
                        <label class="radio" for="reportRights-2">
                            <input type="radio" name="reportRights" id="reportRights-2" value="1"
                                   ng-model="tournamentInfo.userPrivileges" required="required">
                            <span translate="admin.form.userPrivileges.nothing"></span>
                        </label>
                    </div>
                </div>

            </div>
            <div class="row">
                <div class="form-group col-sm-12">
                    <button id="modifyTournament" type="submit" class="btn btn-primary" translate="admin.form.submit">
                    </button>
                </div>
            </div>
        </fieldset>
    </form>
    <div id="tourneyUpdateOk" class="alert alert-success alert-dismissible app-alert" role="alert" hidden>
        <button type="button" class="close alert-fix-close" ng-click="hideAlerts()"><span
                aria-hidden="true">&times;</span><span
                class="sr-only">Close</span></button>
        <span translate="admin.update.success"></span>
    </div>
    <div id="tourneyUpdateKo" class="alert alert-danger alert-dismissible app-alert" role="alert" hidden>
        <button type="button" class="close alert-fix-close" ng-click="hideAlerts()"><span
                aria-hidden="true">&times;</span><span
                class="sr-only">Close</span></button>
        <span translate="admin.update.fail"></span> ({{ 'admin.form.'+errorMessage | translate}})
    </div>
    <fieldset ng-show="!tournamentInfo.running">
        <div class="row">
            <div class="form-group col-sm-6">
                <legend translate="admin.actions.addPlayer"></legend>
                <div class="row">
                    <form ng-submit="addPlayer()">
                        <div class="form-group col-sm-5">
                            <input type="text" name="inputNick" id="inputNick" class="form-control"
                                   placeholder="{{ 'admin.actions.playerNickPlaceholder' | translate}}"
                                   ng-model="nick"/>

                        </div>
                        <div class="form-group col-sm-4">
                            <select name="inputFaction" class="form-control" ng-model="faction"
                                    ng-options="item for item in factions track by item">
                                <option value=""> -- Choose a faction --</option>
                            </select>
                        </div>
                        <div class="form-group col-sm-1">
                            <button class="btn btn-primary" id="registerPlayerGo" type="submit" translate="play.enter.go">
                            </button>
                        </div>
                    </form>
                </div>
                <div id="registrationOk" class="alert alert-success alert-dismissible app-alert" role="alert" hidden>
                    <button type="button" class="close alert-fix-close" ng-click="hideAlerts()"><span
                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <span translate="play.register.success"></span>
                </div>
                <div id="registrationKo" class="alert alert-danger alert-dismissible app-alert" role="alert" hidden>
                    <button type="button" class="close alert-fix-close" ng-click="hideAlerts()"><span
                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <span translate="play.register.fail"></span> ({{ 'play.register.errors.'+errorMessage | translate }})
                </div>
            </div>
            <div class="form-group col-sm-6">

                <legend translate="admin.actions.addMultiplePlayers">*&nbsp;<i
                        class="glyphicon glyphicon-question-sign what-is-this"
                        title="{{'admin.actions.multipleSeedTooltip'|translate}}"></i></legend>
                <div class="row">
                    <div class="form-group col-sm-12">
                        <input id="multiSeedInput" type="file" ng-file-select="onFileSelect($files)">
                        <p>* : <span translate="admin.misc.fileMustBeCSV"></span></p>
                    </div>
                </div>
            </div>
        </div>
        <div id="multipleRegistrationOk" class="alert alert-success alert-dismissible app-alert" role="alert" hidden>
            <button type="button" class="close alert-fix-close" ng-click="hideAlerts()"><span
                    aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            <span translate="admin.actions.multipleRegistrationSuccessful"></span>
        </div>
        <div id="multipleRegistrationKo" class="alert alert-danger alert-dismissible app-alert" role="alert" hidden>
            <button type="button" class="close alert-fix-close" ng-click="hideAlerts()"><span
                    aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            <span translate="play.register.fail"></span> ({{ 'admin.error.'+errorMessage | translate }})
        </div>
    </fieldset>
    <fieldset id="playersList" ng-model="playerList">
        <legend><span translate="play.register.registeredPlayers"></span> ({{playerList.length}})</legend>
        <ul id="sortablePlayerList">
            <li ng-repeat="player in playerList" class="playerInList">
                <span style="float:left"><span ng-if="player.faction"><img src="/images/icon-{{player.faction}}.png"
                                                                           height="20px"></span>{{player.name}} </span>
                <span class="playerInListInfo" id="notes-{{stripped(player.name)}}">{{ 'admin.actions.'+errorMessage | translate }}</span><i
                    ng-hide="tournamentInfo.running" title="{{'admin.actions.removePlayer'|translate}}" class="glyphicon glyphicon-trash"
                    ng-click="removePlayer(player.name)"></i>
            </li>
        </ul>
        <div ng-show="playerList.length == 0">
            <span translate="play.register.noPlayers"> </span>
        </div>
    </fieldset>
</div>


<div ng-include="'partials/footer'"></div>